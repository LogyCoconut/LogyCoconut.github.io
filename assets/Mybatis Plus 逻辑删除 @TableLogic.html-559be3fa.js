import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as l,c as t,a,b as o,d as p,f as c}from"./app-358b0ff8.js";const i={},d={href:"https://baomidou.com/pages/6b03c5/",target:"_blank",rel:"noopener noreferrer"},r=c(`<h3 id="前提条件" tabindex="-1"><a class="header-anchor" href="#前提条件" aria-hidden="true">#</a> 前提条件</h3><h4 id="步骤-1-逻辑删除配置项" tabindex="-1"><a class="header-anchor" href="#步骤-1-逻辑删除配置项" aria-hidden="true">#</a> 步骤 1: 逻辑删除配置项</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">logic-delete-field</span><span class="token punctuation">:</span> flag <span class="token comment"># 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)</span>
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 逻辑已删除值(默认为 1)</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># 逻辑未删除值(默认为 0)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="步骤-2-类字段注解" tabindex="-1"><a class="header-anchor" href="#步骤-2-类字段注解" aria-hidden="true">#</a> 步骤 2: 类字段注解</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@TableLogic</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="对-sql-行为做更改" tabindex="-1"><a class="header-anchor" href="#对-sql-行为做更改" aria-hidden="true">#</a> 对 SQL 行为做更改</h3><blockquote><p>⚠️ 注意, Mybatis Plus 框架提供的逻辑删除能力只对自动注入的 SQL 生效</p><p>也就是说, 在 xml 文件中自己写的 SQL 还是需要加上 <code>deleted = 0</code> 的</p></blockquote><ul><li><p>查找、更新</p><p>会在 where 条件后追加条件过滤已删除数据</p></li><li><p>删除</p><p>delete 语句转变为 update 语句</p></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> deleted<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">and</span> deleted<span class="token operator">=</span><span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="修改逻辑已删除值" tabindex="-1"><a class="header-anchor" href="#修改逻辑已删除值" aria-hidden="true">#</a> 修改逻辑已删除值</h3><p>在某些场景下, deleted 字段可能会被编织进唯一索引中,</p><p>那么当唯一数据被多次删除时, 就会违反唯一约束</p><p>但是, 在 MySQL 中, 当唯一索引的字段存在 NULL 时, 不会发生唯一性冲突</p><p>所以, 有时我们需要将逻辑已删除值设置为 NULL</p><ul><li>增加下列注解属性值</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@TableLogic</span><span class="token punctuation">(</span>delval<span class="token operator">=</span><span class="token string">&quot;NULL&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改全局逻辑已删除值</li></ul>`,17);function u(k,m){const e=s("ExternalLinkIcon");return l(),t("div",null,[a("blockquote",null,[a("p",null,[a("a",d,[o("官方文档说明"),p(e)])])]),r])}const h=n(i,[["render",u],["__file","Mybatis Plus 逻辑删除 @TableLogic.html.vue"]]);export{h as default};
