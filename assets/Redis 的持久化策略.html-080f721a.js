import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as n,o as l,c as r,a as e,b as s,d,f as t}from"./app-bd1b8191.js";const o={},c=t(`<h2 id="rdb" tabindex="-1"><a class="header-anchor" href="#rdb" aria-hidden="true">#</a> RDB</h2><p>默认配置<br> 1 10 10000<br> 900 300 60</p><p>fork 一个子进程进行</p><h2 id="aof" tabindex="-1"><a class="header-anchor" href="#aof" aria-hidden="true">#</a> AOF</h2><p>记录所有的写入操作</p><p>统一都记录到 aof_buf 里面最后在写入 aof 文件中</p><p>appendfsync 配置</p><ul><li>always</li><li>everysec</li><li>no 由操作系统决定什么时候写入</li></ul><h2 id="aof-重写" tabindex="-1"><a class="header-anchor" href="#aof-重写" aria-hidden="true">#</a> AOF 重写</h2><p>用于以下场景</p><ul><li>精简多余操作</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>set key 1
set key 2
set key 3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实最终结果就是</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>set key 3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>将多个指令合并为一个</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rpush key1 1
rpush key1 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rpush key1 1，2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>但是，在重写 AOF 的过程中，可能会有新的指令进来，所以需要一个 aof 重写缓冲区，把后来进来的写命令同时 copy 一份到重写缓冲区中<br> 在 aof 文件重写完成后，将 aof 重写缓冲区的命令再写入新的 aof 文件中，最后重命名新的 aof 文件，替换掉旧的 aof 文件</p><h3 id="aof-重写步骤" tabindex="-1"><a class="header-anchor" href="#aof-重写步骤" aria-hidden="true">#</a> AOF 重写步骤</h3><ol><li>fork 子进程进行重写工作</li><li>重写过程中如果有写命令，需要同时 copy 一份到 aof 重写缓冲区中</li><li>重写完成后，将 aof 重写缓冲区的命令写到新 aof 文件中</li><li>重命名新 aof 文件，替换掉旧的 aof 文件</li></ol>`,20),u={href:"https://www.cnblogs.com/xuanyuan/p/13689484.html",target:"_blank",rel:"noopener noreferrer"};function p(h,f){const a=n("ExternalLinkIcon");return l(),r("div",null,[c,e("p",null,[e("a",u,[s("https://www.cnblogs.com/xuanyuan/p/13689484.html"),d(a)])])])}const b=i(o,[["render",p],["__file","Redis 的持久化策略.html.vue"]]);export{b as default};
